.PHONY: install start stop remove

KALI_USER=kali
KALI_PASSWORD=kali

install:
	@if ! docker network ls | grep -q simulation_net; then \
		docker network create simulation_net; \
	fi
	docker build -t targeted_nginx . -f=./Targeted/nginx
	docker build -t targeted_httpd . -f=./Targeted/httpd
	sed -i '' 's/ARG KALI_USER=kali/ARG KALI_USER=$(KALI_USER)/g' Attacker/kali-novnc
	sed -i '' 's/ARG KALI_PASSWORD=kali@123/ARG KALI_PASSWORD=$(KALI_PASSWORD)/g' Attacker/kali-novnc
	docker build -t attacker_kali-novnc ./Attacker -f=./Attacker/kali-novnc

	sed -i '' 's/ARG KALI_USER=kali/ARG KALI_USER=$(KALI_USER)/g' Attacker/kali-xrdp
	sed -i '' 's/ARG KALI_PASSWORD=kali@123/ARG KALI_PASSWORD=$(KALI_PASSWORD)/g' Attacker/kali-xrdp
	docker build -t attacker_kali-xrdp ./Attacker -f=./Attacker/kali-xrdp

	sed -i '' 's/ARG KALI_USER=kali/ARG KALI_USER=$(KALI_USER)/g' Attacker/kali-x11
	sed -i '' 's/ARG KALI_PASSWORD=kali@123/ARG KALI_PASSWORD=$(KALI_PASSWORD)/g' Attacker/kali-x11
	docker build -t attacker_kali-x11 ./Attacker -f=./Attacker/kali-x11

	docker-compose -f docker-compose-simulation.yml up -d

start:
	docker-compose -f docker-compose-simulation.yml up -d

stop:
	docker-compose -f docker-compose-simulation.yml stop

remove:
	docker-compose -f docker-compose-simulation.yml down -v 