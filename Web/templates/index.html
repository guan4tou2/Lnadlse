<!DOCTYPE html>
<html lang="zh">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>容器管理系统</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <style>
      .container-card {
        margin-bottom: 20px;
      }
      .status-running {
        color: green;
      }
      .status-exited {
        color: red;
      }
    </style>
  </head>
  <body>
    <div class="container mt-5">
      <h1 class="mb-4">容器管理系统</h1>

      <!-- ELK Stack 控制 -->
      <div class="card mb-4">
        <div class="card-header">
          <h3>ELK Stack 控制</h3>
        </div>
        <div class="card-body">
          <button class="btn btn-primary" onclick="startELK()">
            启动 ELK Stack
          </button>
        </div>
      </div>

      <!-- 模拟环境控制 -->
      <div class="card mb-4">
        <div class="card-header">
          <h3>模拟环境控制</h3>
        </div>
        <div class="card-body">
          <div class="row mb-3">
            <div class="col">
              <select class="form-select" id="targetType">
                <option value="">选择目标机器类型</option>
                <option value="nginx">Nginx 目标机器</option>
                <option value="httpd">Apache 目标机器</option>
              </select>
            </div>
            <div class="col">
              <button class="btn btn-success" onclick="startTarget()">
                启动目标机器
              </button>
            </div>
          </div>
          <div class="row">
            <div class="col">
              <button class="btn btn-warning" onclick="startAttacker()">
                启动攻击机器
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- 容器状态 -->
      <div class="card">
        <div class="card-header">
          <h3>容器状态</h3>
        </div>
        <div class="card-body">
          <div id="containerList" class="row"></div>
        </div>
      </div>

      <!-- 停止所有服务 -->
      <div class="mt-4">
        <button class="btn btn-danger" onclick="stopAll()">
          停止所有服务
        </button>
      </div>
    </div>

    <script>
      function startELK() {
        fetch("/api/start_elk", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            updateContainerStatus();
          })
          .catch((error) => {
            alert("Error: " + error);
          });
      }

      function startTarget() {
        const targetType = document.getElementById("targetType").value;
        if (!targetType) {
          alert("请选择目标机器类型");
          return;
        }

        fetch("/api/start_target", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ type: targetType }),
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            updateContainerStatus();
          })
          .catch((error) => {
            alert("Error: " + error);
          });
      }

      function startAttacker() {
        fetch("/api/start_attacker", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            updateContainerStatus();
          })
          .catch((error) => {
            alert("Error: " + error);
          });
      }

      function stopAll() {
        fetch("/api/stop_all", {
          method: "POST",
        })
          .then((response) => response.json())
          .then((data) => {
            alert(data.message);
            updateContainerStatus();
          })
          .catch((error) => {
            alert("Error: " + error);
          });
      }

      function updateContainerStatus() {
        fetch("/api/containers")
          .then((response) => response.json())
          .then((containers) => {
            const containerList = document.getElementById("containerList");
            containerList.innerHTML = "";

            containers.forEach((container) => {
              const statusClass = container.status === "running" ? "status-running" : "status-exited";
              const card = document.createElement("div");
              card.className = "col-md-4 mb-3";
              card.innerHTML = `
                <div class="card">
                  <div class="card-body">
                    <h5 class="card-title">${container.name}</h5>
                    <p class="card-text">
                      状态: <span class="${statusClass}">${container.status}</span>
                    </p>
                  </div>
                </div>
              `;
              containerList.appendChild(card);
            });
          })
          .catch((error) => {
            console.error("Error fetching container status:", error);
          });
      }

      // 页面加载时更新容器状态
      document.addEventListener("DOMContentLoaded", updateContainerStatus);
    </script>
  </body>
</html>
